<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadastro de Programa</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">

<div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-md">

  <h1 class="text-3xl font-bold text-center mb-6">Cadastro de Programa</h1>

  <!-- Campos principais do programa -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <div>
      <label class="block font-semibold mb-1">Código do Programa</label>
      <input type="text" id="codigo" class="border rounded p-2 w-full">
    </div>
    <div>
      <label class="block font-semibold mb-1">Padrão 1</label>
      <input type="number" id="padrao1" class="border rounded p-2 w-full">
    </div>
    <div>
      <label class="block font-semibold mb-1">Qtd Matrizes</label>
      <select id="qtd_matrizes" class="border rounded p-2 w-full">
        <option value="12">12</option>
        <option value="18">18</option>
      </select>
    </div>
  </div>

  <!-- Tabela de matrizaria -->
  <h2 class="text-2xl font-bold mb-2">Matrizaria</h2>
  <div class="overflow-x-auto mb-4">
    <table class="border w-full table-auto text-center">
      <thead>
        <tr class="bg-gray-200">
          <th class="border p-2">Numeração</th>
          <th class="border p-2">Qtd Matrizes</th>
          <th class="border p-2">Giros Inicial</th>
        </tr>
      </thead>
      <tbody id="tabelaMatrizaria">
        <tr class="hover:bg-gray-50">
          <td><input type="number" class="border rounded p-1 w-full numeracao"></td>
          <td><input type="number" class="border rounded p-1 w-full matrizes"></td>
          <td><input type="number" class="border rounded p-1 w-full girosInicial"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Botões -->
  <div class="flex flex-wrap gap-4">
    <button class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded shadow" onclick="adicionarLinha()">Adicionar Linha</button>
    <button class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded shadow" onclick="salvarPrograma()">Salvar Programa</button>
  </div>

</div>

<script>
function adicionarLinha() {
  const tbody = document.getElementById('tabelaMatrizaria');
  const tr = document.createElement('tr');
  tr.classList.add('hover:bg-gray-50');
  tr.innerHTML = `
    <td><input type="number" class="border rounded p-1 w-full numeracao"></td>
    <td><input type="number" class="border rounded p-1 w-full matrizes"></td>
    <td><input type="number" class="border rounded p-1 w-full girosInicial"></td>
  `;
  tbody.appendChild(tr);
}

async function salvarPrograma() {
  const codigo = document.getElementById('codigo').value;
  const padrao1 = Number(document.getElementById('padrao1').value);
  const qtd_matrizes = Number(document.getElementById('qtd_matrizes').value);

  const dados_matrizaria = [];
  document.querySelectorAll('#tabelaMatrizaria tbody tr').forEach(tr => {
    const numeracaoInput = tr.querySelector('.numeracao');
    const matrizesInput = tr.querySelector('.matrizes');
    const girosInput = tr.querySelector('.girosInicial');

    if (numeracaoInput && matrizesInput && girosInput) {
      const numeracao = Number(numeracaoInput.value);
      const matrizes = Number(matrizesInput.value);
      const girosInicial = Number(girosInput.value);
      dados_matrizaria.push({ numeracao, matrizes, girosInicial });
    }
  });

  try {
    const res = await fetch("https://producao2-one.vercel.app/index.html", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ codigo, padrao1, qtd_matrizes, dados_matrizaria })
    });

    let data;
    try {
      data = await res.json();
    } catch {
      alert("O backend não retornou JSON válido.");
      return;
    }

    if (res.ok) {
      alert("Programa salvo com sucesso!");
      // opcional: limpar formulário
      document.getElementById('codigo').value = '';
      document.getElementById('padrao1').value = '';
      document.getElementById('qtd_matrizes').value = '12';
      document.getElementById('tabelaMatrizaria').innerHTML = `
        <tr class="hover:bg-gray-50">
          <td><input type="number" class="border rounded p-1 w-full numeracao"></td>
          <td><input type="number" class="border rounded p-1 w-full matrizes"></td>
          <td><input type="number" class="border rounded p-1 w-full girosInicial"></td>
        </tr>
      `;
    } else {
      alert("Erro: " + data.error);
    }

  } catch (err) {
    console.error(err);
    alert("Erro ao salvar programa: " + err.message);
  }
}
</script>

</body>
</html>
