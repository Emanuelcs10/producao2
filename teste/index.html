<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadastro de Programa</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4 bg-gray-100">

<h1 class="text-2xl font-bold mb-4">Cadastro de Programa</h1>

<div class="mb-4">
  <label class="block mb-1">Código do Programa:</label>
  <input type="text" id="codigo" class="border p-2 w-full">
</div>

<div class="mb-4">
  <label class="block mb-1">Padrão 1:</label>
  <input type="number" id="padrao1" class="border p-2 w-full">
</div>

<div class="mb-4">
  <label class="block mb-1">Qtd Matrizes:</label>
  <select id="qtd_matrizes" class="border p-2 w-full">
    <option value="12">12</option>
    <option value="18">18</option>
  </select>
</div>

<h2 class="text-xl font-bold mb-2">Matrizaria</h2>
<table class="border w-full mb-4">
  <thead>
    <tr class="bg-gray-200">
      <th class="border p-2">Numeração</th>
      <th class="border p-2">Qtd Matrizes</th>
      <th class="border p-2">Giros Inicial</th>
    </tr>
  </thead>
  <tbody id="matrizariaBody">
    <tr>
      <td><input type="number" class="border p-1 numeracao"></td>
      <td><input type="number" class="border p-1 matrizes"></td>
      <td><input type="number" class="border p-1 girosInicial"></td>
    </tr>
  </tbody>
</table>

<button class="bg-blue-500 text-white px-4 py-2" onclick="adicionarLinha()">Adicionar Linha</button>
<button class="bg-green-500 text-white px-4 py-2 ml-2" onclick="salvarPrograma()">Salvar Programa</button>

<script>
function adicionarLinha() {
  const tbody = document.getElementById('matrizariaBody');
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input type="number" class="border p-1 numeracao"></td>
    <td><input type="number" class="border p-1 matrizes"></td>
    <td><input type="number" class="border p-1 girosInicial"></td>
  `;
  tbody.appendChild(tr);
}

async function salvarPrograma() {
  const codigo = document.getElementById('codigo').value;
  const padrao1 = Number(document.getElementById('padrao1').value);
  const qtd_matrizes = Number(document.getElementById('qtd_matrizes').value);

  const tbody = document.getElementById('matrizariaBody');
  const dados_matrizaria = [];
  tbody.querySelectorAll('tr').forEach(tr => {
    const numeracao = Number(tr.querySelector('.numeracao').value);
    const matrizes = Number(tr.querySelector('.matrizes').value);
    const girosInicial = Number(tr.querySelector('.girosInicial').value);
    dados_matrizaria.push({ numeracao, matrizes, girosInicial });
  });

  const res = await fetch("https://producao2-one.vercel.app/cadastro.html", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ codigo, padrao1, qtd_matrizes, dados_matrizaria })
  });

  const data = await res.json();
  alert(data.message || data.error);
}
</script>

</body>
</html>
